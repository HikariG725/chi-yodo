<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ちいよどぽーたる</title>
  <script>
    (function () {
      if (location.protocol === "file:") return;
      const parts = location.pathname.split("/").filter(Boolean);
      const base = parts.length ? "/" + parts[0] : "";
      const script = document.createElement("script");
      script.src = base + "/assets/auth.js";
      script.defer = true;
      document.head.appendChild(script);
    })();
  </script>
  <style>
    :root {
      --ink: #1f1d1a;
      --muted: #5c5a57;
      --accent: #0f766e;
      --paper: #f6f5f2;
      --card: #ffffff;
      --line: #e8e0d6;
      --shadow: 0 10px 24px rgba(28, 22, 16, 0.1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      color: var(--ink);
      font-family: "Noto Sans JP", "Yu Gothic", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
      background: radial-gradient(1000px 280px at 10% -40%, rgba(15, 118, 110, 0.12), transparent 60%), var(--paper);
      line-height: 1.7;
    }

    a {
      color: inherit;
    }

    .secret-admin-link {
      text-decoration: none;
      cursor: inherit;
    }

    main {
      max-width: 1080px;
      margin: 0 auto;
      padding: 32px 20px 80px;
    }

    header.hero {
      background: linear-gradient(120deg, #ffffff 0%, #f1f7f6 45%, #ffffff 100%);
      border: 1px solid var(--line);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 28px;
    }

    .eyebrow {
      color: var(--accent);
      font-weight: 700;
      letter-spacing: 0.08em;
      font-size: 0.78rem;
      text-transform: uppercase;
    }

    h1 {
      margin: 8px 0 12px;
      font-size: clamp(1.6rem, 1.6vw + 1rem, 2.4rem);
    }

    .hero-sub {
      color: var(--muted);
      max-width: 48rem;
      margin: 0;
    }

    section {
      margin-top: 28px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.15rem;
      margin: 0 0 14px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.1);
      color: var(--accent);
      font-size: 0.78rem;
      font-weight: 700;
    }

    .grid {
      display: grid;
      gap: 16px;
    }

    .grid.cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .accordion {
      display: grid;
      gap: 12px;
    }

    details {
      border: 1px solid var(--line);
      border-radius: 16px;
      background: var(--card);
      box-shadow: 0 8px 20px rgba(28, 22, 16, 0.08);
      overflow: hidden;
    }

    summary {
      list-style: none;
      cursor: pointer;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-weight: 800;
    }

    summary::-webkit-details-marker {
      display: none;
    }

    .summary-left {
      display: grid;
      gap: 4px;
    }

    .summary-title {
      font-size: 1.05rem;
    }

    .summary-sub {
      color: var(--muted);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .chev {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid rgba(15, 118, 110, 0.2);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      background: rgba(15, 118, 110, 0.08);
      flex: 0 0 auto;
      transition: transform 160ms ease;
    }

    details[open] .chev {
      transform: rotate(180deg);
    }

    .details-body {
      padding: 0 18px 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 18px 18px 16px;
      box-shadow: 0 8px 20px rgba(28, 22, 16, 0.08);
    }

    .card h3 {
      margin: 0 0 8px;
      font-size: 1rem;
    }

    .muted {
      color: var(--muted);
      font-size: 0.95rem;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      border-radius: 999px;
      background: var(--accent);
      color: #ffffff;
      text-decoration: none;
      font-weight: 700;
      border: 1px solid rgba(15, 118, 110, 0.4);
    }

    .button.outline {
      background: transparent;
      color: var(--accent);
    }

    .quick-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .pill-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.1);
      color: var(--accent);
      font-weight: 800;
      text-decoration: none;
      border: 1px solid rgba(15, 118, 110, 0.18);
    }

    .calendar-wrap {
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--line);
      background: #ffffff;
    }

    .calendar-iframe {
      width: 100%;
      height: 640px;
      border: 0;
    }

    .fineprint {
      margin: 10px 0 0;
      font-size: 0.86rem;
      color: var(--muted);
    }

    @media (max-width: 900px) {
      .grid.cols-2 {
        grid-template-columns: 1fr;
      }
      header.hero {
        padding: 22px;
      }
      .calendar-iframe {
        height: 520px;
      }
    }
  </style>
</head>
<body>
  <main id="gate" style="display:none;">
    <div class="card">
      <h1>ちいよどぽーたる</h1>
      <p class="muted">合言葉を入力してください。</p>
      <form id="gateForm" class="button-group" autocomplete="off" style="margin-top: 12px;">
        <input id="pw" type="password" inputmode="text" placeholder="合言葉" aria-label="合言葉" required style="flex:1 1 260px; padding:10px 12px; border-radius:12px; border:1px solid var(--line); font-size:1rem;">
        <button class="button" type="submit">入る</button>
      </form>
      <div id="error" class="fineprint" style="display:none; color:#b91c1c; font-weight:700;">合言葉が違います。</div>
    </div>
  </main>

  <main id="portal" style="display:none;">
    <header class="hero">
      <div class="eyebrow">Chiiyodo Portal</div>
      <h1>ちいよどぽーたる</h1>
      <p class="hero-sub">練習・本番に関する連絡や資料の入口です。<a class="secret-admin-link" href="protected/manage.html">出欠登録</a>、当日の動き、カレンダーをまとめています。</p>
    </header>

    <section>
      <div class="section-title">クイックアクセス <span class="badge">Quick</span></div>
      <div class="card">
        <div class="quick-links">
          <a class="pill-link" href="#events">イベント一覧</a>
          <a class="pill-link" href="#yokohama2026">横浜アンコン 2026</a>
          <a class="pill-link" href="#mixfes2026">混フェス 2026</a>
          <a class="pill-link" href="#ovec2026">OVEC 2026</a>
          <a class="pill-link" href="protected/youtube.html">練習録音（YouTube）</a>
          <a class="pill-link" href="#calendar">カレンダー</a>
        </div>
        <p class="fineprint">よく使うリンクをまとめています。イベント資料は「イベント一覧」から探せます。</p>
      </div>
    </section>

    <section id="events">
      <div class="section-title">イベント一覧 <span class="badge">Events</span></div>
      <div class="accordion">
        <details id="yokohama2026">
          <summary>
            <div class="summary-left">
              <div class="summary-title" style="display:flex; align-items:baseline; gap:10px;">横浜アンコン 2026 <span style="margin-left:auto; color:#ef4444; font-style:italic; font-weight:800;">New!!</span></div>
              <div class="summary-sub">要項・出欠（伝助）を追加しました</div>
            </div>
            <span class="chev" aria-hidden="true">⌄</span>
          </summary>
          <div class="details-body">
            <p class="muted">2026-08-22 / 横浜みなとみらいホール（小ホール）</p>
            <div class="button-group">
              <a class="button" href="https://densuke.biz/list?cd=agYkDsDGpgEsTPTF" target="_blank" rel="noopener">伝助（出欠）</a>
              <a class="button outline" href="https://drive.google.com/drive/folders/1T6GL1pzrAXRsuLvCoJHLWVX-c5Ug7i5r" target="_blank" rel="noopener">資料（Google Drive）</a>
            </div>
          </div>
        </details>

        <details id="mixfes2026">
          <summary>
            <div class="summary-left">
              <div class="summary-title" style="display:flex; align-items:baseline; gap:10px;">混フェス 2026 <span style="margin-left:auto; color:#ef4444; font-style:italic; font-weight:800;">New!!</span></div>
              <div class="summary-sub">当日の動き（確定版）を掲載しています</div>
            </div>
            <span class="chev" aria-hidden="true">⌄</span>
          </summary>
          <div class="details-body">
            <div class="button-group">
              <a class="button" href="https://densuke.biz/list?cd=HU6qfy2B5QpDxtCW" target="_blank" rel="noopener">伝助（練習日程）</a>
              <a class="button" href="https://densuke.biz/list?cd=Wk24VUWBrTgMafYe" target="_blank" rel="noopener">伝助（オンステ調査）</a>
              <a class="button outline" href="2026/16_mixfes/day.html">当日の動き（確定版）</a>
              <a class="button outline" href="2026/16_mixfes/archive/day_v2_compare.html">アーカイブ（旧案）</a>
              <a class="button outline" href="https://drive.google.com/drive/folders/1upwYMZF5flNOvjim_320eGUVRa9iK3pd" target="_blank" rel="noopener">資料（Google Drive）</a>
            </div>
          </div>
        </details>

        <details id="ovec2026">
          <summary>
            <div class="summary-left">
              <div class="summary-title">OVEC 2026</div>
              <div class="summary-sub">伝助・当日の動き・資料リンクを掲載しています</div>
            </div>
            <span class="chev" aria-hidden="true">⌄</span>
          </summary>
          <div class="details-body">
            <div class="button-group">
              <a class="button" href="https://densuke.biz/list?cd=4QPLXkxx7aPDDETN" target="_blank" rel="noopener">伝助（練習日程）</a>
              <a class="button" href="https://densuke.biz/list?cd=Jnrncm774RWbRF7M" target="_blank" rel="noopener">伝助（オンステ調査）</a>
              <a class="button outline" href="2026/25_ovec/day.html">当日の動き</a>
              <a class="button outline" href="https://drive.google.com/drive/folders/1Bntz6LYhCEMus8CRliv1eVfwDwdLlBZm" target="_blank" rel="noopener">資料（Google Drive）</a>
              <a class="button outline" href="https://youtube.com/playlist?list=PLaz9JrXws_Ee7CubyN8-rwzKESEun5t4g" target="_blank" rel="noopener">本番音源（YouTube）</a>
            </div>
          </div>
        </details>
      </div>
    </section>

    <section id="calendar">
      <div class="section-title">カレンダー <span class="badge">Schedule</span></div>
      <div class="card">
        <div class="calendar-wrap">
          <iframe class="calendar-iframe" title="ちいよどカレンダー" src="https://calendar.google.com/calendar/u/0/embed?src=chiiyodo@gmail.com&ctz=Asia/Tokyo" loading="lazy"></iframe>
        </div>
        <p class="fineprint">埋め込みが表示されない場合は「別タブで開く」から確認してください。</p>
        <div class="button-group">
          <a class="button outline" href="https://calendar.google.com/calendar/u/0/embed?src=chiiyodo@gmail.com&ctz=Asia/Tokyo" target="_blank" rel="noopener">別タブで開く</a>
          <a class="button outline" href="https://drive.google.com/drive/u/2/folders/1-P5_7eC8mBZSYi8EZzBNZmXXm9Mdqnmm" target="_blank" rel="noopener">ちいよどGoogle Drive</a>
        </div>
      </div>
    </section>
  </main>

  <script>
    (function () {
      if (location.protocol === "file:") {
        document.getElementById("portal").style.display = "";
        return;
      }

      const AUTH_KEY = "chiiyodo_auth_v1";
      const PASSWORD_SHA256_HEXES = new Set([
        "d26ef39e288a2545f53b57eddcbbc712f8ac93b9a51c05254c02cad06b54785d",
        "66a3a47721dab7eedc7cf96f0e15dd967bd8200825a46a621a74d5f1332480ed"
      ]);

      function toHex(buffer) {
        return Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2, "0")).join("");
      }

      async function sha256Hex(text) {
        const data = new TextEncoder().encode(text);
        const digest = await crypto.subtle.digest("SHA-256", data);
        return toHex(digest);
      }

      function safeNext(next) {
        if (!next) return null;
        if (!next.startsWith("/")) return null;
        if (next.includes("\n") || next.includes("\r")) return null;
        return next;
      }

      const params = new URLSearchParams(location.search);
      const next = safeNext(params.get("next"));

      const gate = document.getElementById("gate");
      const portal = document.getElementById("portal");

      const authed = sessionStorage.getItem(AUTH_KEY) === "1";
      if (authed) {
        portal.style.display = "";
        return;
      }

      gate.style.display = "";

      const form = document.getElementById("gateForm");
      const pw = document.getElementById("pw");
      const error = document.getElementById("error");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        error.style.display = "none";
        const input = pw.value ?? "";
        const hash = await sha256Hex(input);
        if (!PASSWORD_SHA256_HEXES.has(hash)) {
          error.style.display = "";
          return;
        }
        sessionStorage.setItem(AUTH_KEY, "1");
        pw.value = "";
        location.assign(next || "index.html");
      });
    })();
  </script>
</body>
</html>
